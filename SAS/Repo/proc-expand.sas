/* Example of the proc expand using macro-economic data */
data macroeconomics1 (keep=date CPI);
  format date date.;
  infile cards dlm=',';
  input yyq $ CPI CPI_yoy	RPI Real_wages base_rate LIBOR_1m LIBOR_3m LIBOR_6m	LIBOR_12m swap_rate_2yr	swap_rate_5yr swap_rate_10yr swap_rate_20yr	gilts_10y gilts_20y	AA_Corp_bond_yield Year_Break_Evens_20y	dollar_pount euro_pound	swap_rate_30yr 	government_bond_yield_5y Sterling_IG_corp_bond_spreads Sterling_HY_corp_bond_spreads;
  date=input(yyq,yyq6.);
cards;
2000Q1,92.73,0.85,167.50,132.37,5.86,6.05,6.12,6.47,6.71,6.82,6.79,6.36,5.67,5.41,4.36,6.10,2.80,1.61,1.63,5.72,6.09,128.00,555.00
2000Q2,92.86,0.61,170.63,134.49,6.00,6.07,6.28,6.34,6.69,6.64,6.59,6.33,5.90,5.14,4.37,6.30,2.80,1.53,1.64,5.99,5.74,147.00,615.00
2000Q3,93.07,0.71,170.90,138.71,6.00,6.10,6.21,6.27,6.48,6.37,6.45,6.34,5.97,5.17,4.50,6.10,2.80,1.48,1.63,5.86,5.63,149.00,672.00
2000Q4,93.54,0.98,171.97,140.65,6.00,5.85,6.07,5.87,6.14,5.98,6.04,5.92,5.56,4.95,4.44,5.60,2.50,1.45,1.67,5.33,5.31,138.00,858.00
2001Q1,93.49,0.82,171.77,142.69,5.85,5.69,5.72,5.37,5.55,5.44,5.59,5.58,5.37,4.69,4.40,5.80,2.50,1.46,1.58,5.33,4.99,137.00,734.00
2001Q2,94.27,1.51,173.90,144.65,5.37,5.22,5.30,5.43,5.35,5.39,5.59,5.69,5.63,5.01,4.86,6.10,2.70,1.42,1.63,5.73,5.12,122.00,735.00
2001Q3,94.51,1.55,173.97,145.23,5.05,4.70,5.00,4.48,5.15,5.34,5.60,5.61,5.45,4.98,4.82,5.80,2.50,1.44,1.61,5.29,5.07,117.00,793.00
2001Q4,94.54,1.07,173.77,147.08,4.22,4.15,4.16,4.14,4.31,4.72,5.22,5.27,5.09,4.74,4.62,5.60,2.60,1.44,1.61,5.01,4.72,125.00,879.00
2002Q1,94.94,1.55,173.87,145.83,4.00,4.02,4.08,4.40,4.62,5.06,5.41,5.40,5.18,4.96,4.81,5.80,2.90,1.43,1.63,5.28,5.03,108.00,860.00
2002Q2,95.18,0.97,176.03,148.00,4.00,3.96,4.17,4.33,4.80,5.16,5.49,5.51,5.41,5.14,5.02,5.60,2.70,1.46,1.59,5.12,5.17,100.00,697.00
2002Q3,95.48,1.03,176.63,149.07,4.00,3.94,4.01,3.94,4.24,4.51,4.95,5.12,5.08,4.72,4.61,5.30,2.40,1.55,1.57,4.73,4.58,123.00,819.00
2002Q4,95.94,1.48,178.20,150.07,4.00,4.06,3.98,3.99,4.08,4.27,4.69,4.97,5.04,4.59,4.57,5.30,2.40,1.57,1.57,4.80,4.36,133.00,884.00
2003Q1,96.32,1.45,179.20,148.70,3.85,3.71,3.80,3.60,3.74,3.80,4.28,4.66,4.85,4.31,4.47,5.30,2.50,1.60,1.49,4.77,4.00,126.00,860.00
2003Q2,96.40,1.28,181.33,152.56,3.75,3.67,3.64,3.57,3.56,3.65,4.11,4.52,4.84,4.28,4.54,5.10,2.50,1.62,1.42,4.73,3.89,108.00,700.00
2003Q3,96.82,1.40,181.80,153.59,3.53,3.69,3.57,3.83,3.79,4.05,4.46,4.73,4.94,4.57,4.71,5.40,2.70,1.61,1.43,4.83,4.24,89.00,601.00
2003Q4,97.20,1.32,182.93,153.43,3.65,3.90,3.93,4.17,4.42,4.69,5.03,5.11,5.08,4.93,4.82,5.30,2.80,1.71,1.43,4.92,4.76,76.00,474.00
2004Q1,97.50,1.23,183.83,153.22,3.90,4.19,4.17,4.53,4.54,4.67,4.93,5.02,5.01,4.74,4.68,5.40,3.00,1.84,1.47,4.94,4.60,78.00,421.00
2004Q2,97.78,1.44,186.33,155.86,4.21,4.63,4.57,5.04,5.06,5.17,5.35,5.37,5.25,5.04,4.87,5.70,3.00,1.81,1.50,5.15,4.97,83.00,398.00
2004Q3,98.05,1.27,187.43,157.03,4.65,4.85,4.92,5.00,5.24,5.21,5.31,5.30,5.11,4.95,4.72,5.40,2.90,1.82,1.49,4.91,4.92,84.00,403.00
2004Q4,98.60,1.44,189.17,156.92,4.75,4.86,4.88,4.92,4.99,4.86,4.91,4.94,4.81,4.62,4.50,5.20,2.90,1.87,1.44,4.67,4.55,77.00,341.00
2005Q1,99.30,1.84,189.67,157.59,4.75,4.87,4.92,5.04,5.06,4.93,4.92,4.91,4.78,4.59,4.51,5.20,3.00,1.89,1.44,4.80,4.57,68.00,284.00
2005Q2,99.65,1.90,191.93,157.18,4.75,4.82,4.89,4.67,4.88,4.68,4.69,4.71,4.64,4.40,4.39,4.80,2.70,1.86,1.47,4.40,4.34,80.00,378.00
2005Q3,100.31,2.30,192.63,157.44,4.59,4.60,4.62,4.57,4.52,4.40,4.47,4.54,4.49,4.24,4.27,4.80,2.90,1.78,1.46,4.43,4.17,73.00,374.00
2005Q4,100.71,2.14,193.67,158.83,4.50,4.66,4.61,4.59,4.64,4.58,4.62,4.59,4.42,4.25,4.18,4.50,2.90,1.75,1.47,4.20,4.25,74.00,376.00
;
run;

/* Create the different transformations using proc expand */
proc expand data=macroeconomics1 method=none out=macroeconomics;
	id date ;
	convert CPI=CPI_yoy/transformin=(dif 4);
	convert CPI=lag1q_CPI/transformin=(dif 4 lag 1);
	convert CPI=lag1q_log_CPI/transformin=(pctdif 4);
	convert CPI=CPI_4QMA/transformin=(movave 4);
run;

/* Additional transformations performed using a macro */
%macro all_trans_rev(input_data=, input_var=, end=, output_data=);

	proc datasets lib=work nodetails nolist;
		delete &output_data.;
	run;

	%do i = 1 %to &end.;

		proc expand data=&input_data. out=out&i.;
			convert &input_var. = dif&i. / transformout = (dif &i.);
			convert &input_var. = lag&i. / transformout = (lag &i.);	
			convert &input_var. = movave&i. / transformout = (movave &i.);
		run;
		
	%end;

	data &output_data.;
		merge &input_data. out1 - out&end. ;
	run;

	proc datasets lib=work nodetails nolist;
		delete out: ;
	run;

%mend;

%all_trans_rev(input_data=macroeconomics, input_var=CPI, end=12, output_data=data_CPI);
